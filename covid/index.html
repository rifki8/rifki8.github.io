<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Covid-19 ID</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.css" integrity="sha512-PMjWzHVtwxdq7m7GIxBot5vdxUY+5aKP9wpKtvnNBZrVv1srI8tU6xvFMzG8crLNcMj/8Xl/WWmo/oAP/40p1g==" crossorigin="anonymous" />
  <!-- iCheck -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/icheck-bootstrap/3.0.1/icheck-bootstrap.min.css" integrity="sha512-8vq2g5nHE062j3xor4XxPeZiPjmRDh6wlufQlfC6pdQ/9urJkU07NM0tEREeymP++NczacJ/Q59ul+/K2eYvcg==" crossorigin="anonymous" />
  <!-- Theme style -->
  <link rel="stylesheet" href="css/adminlte.min.css">
  <link rel="stylesheet" href="css/style.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.12.0/css/OverlayScrollbars.min.css" integrity="sha512-fWgz39WeLATUXnAhIimPHnEUoSuZh5cgcOTteRFeVPW1opB0OPQ2/JwPAAWMDZtHy8IomUEOyaYJsOdCM9tcYg==" crossorigin="anonymous" />
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Contact</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">About</a>
      </li>
    </ul>
    <ul class="navbar-nav">

    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index.html" class="brand-link">
      <i class="fas fa-virus brand-image elevation-3 h1 my-0 mx-3"></i>
      <span class="brand-text font-weight-light">Covid-19 ID</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="img/profile.JPG" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Muhammad Rifki</a>
        </div>
      </div>


      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-header">KETERANGAN</li>
          <div class="row px-4">
            <span class="w-100 badge badge-warning p-2 mt-1"><i class="fas fa-virus mr-1"></i> Positif</span>
            <span class="w-100 badge badge-success p-2 mt-1"><i class="fas fa-heart mr-1"></i> Sembuh</span>
            <span class="w-100 badge badge-danger p-2 mt-1"><i class="fas fa-heart-broken mr-1"></i> Meninggal</span>
          </div>

          <hr>

          <li class="nav-header">DAFTAR PROVINSI</li>

          <!-- SidebarSearch Form -->
          <div class="form-inline mt-2">
            <div class="input-group" data-widget="sidebar-search">
              <input id="search" class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
            </div>
          </div>

        </ul>
        <ul id="listProv" class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">Peta Persebaran Covid-19 di Indonesia</h1>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div id="map">

        </div>
      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2020 <a href="#">Muhammad Rifki</a>.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      Covid-19 <b>ID</b>
    </div>
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<!-- jQuery UI 1.11.4 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha512-uto9mlQzrs59VwILcLiRYeLKPPbS/bT71da/OEBYEwcdNUk8jYIy+D176RYoop1Da+f9mvkYrmj5MCLZWEtQuA==" crossorigin="anonymous"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button)
</script>
<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
<!-- Bootstrap 4 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha512-Oy5BruJdE3gP9+LMJ11kC5nErkh3p4Y0GawT1Jrcez4RTDxODf3M/KP3pEsgeOYxWejqy2SPnj+QMpgtvhDciQ==" crossorigin="anonymous"></script>
<!-- Tempusdominus Bootstrap 4 -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/js/tempusdominus-bootstrap-4.js" integrity="sha512-Cl+0GhvmBu0MfoP4/EN/Ha56ClBj8+jyyqFjL9+PCrWaVR7XH9m9qghZi7qMO04hbVD8zyi/I7LRhN485WWsGQ==" crossorigin="anonymous"></script> -->
<!-- overlayScrollbars -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.12.0/js/jquery.overlayScrollbars.min.js" integrity="sha512-Z8BrxiEnf+IbffE67XlYCq7k8x8/vF7n8AzmW0TZSPvsAj5DlSceYILP1KOvyA3FcllxyJbdZcWEUdbs1IeerA==" crossorigin="anonymous"></script>
<!-- AdminLTE App -->
<script src="js/adminlte.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="js/demo.js"></script>
<script>

$(document).ready(function(){
  $("#search").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#listProv li").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

  var map = L.map('map').setView([ -0.789275, 117.921327], 5);

  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox/light-v9',
      tileSize: 512,
      zoomOffset: -1,
      accessToken: 'pk.eyJ1Ijoicmlma2k4IiwiYSI6ImNrYzhueTVzejB1azMyc280dmlnZjBxZ2EifQ.uOgTXz8OpkjLh2RldvXLCA'
  }).addTo(map);

  var api = "https://services5.arcgis.com/VS6HdKS0VfIhv8Ct/arcgis/rest/services/COVID19_Indonesia_per_Provinsi/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json";
  var dataCovid = [];
  var geojson = [];
  var geojson2 = [];
  getData();

  $(document).on("click", "#listProv .nav-item", function(){
    var id = $(this).data("id");
    var set = geojson[id];
    var set2 = geojson2[id];
    set.eachLayer(function(feature){
  		map.fitBounds(feature.getBounds());
  	});
    set2.openPopup();
  });


  function getColor(positif) {
   return positif > 15000 ? '#800026' :
          positif > 10000 ? '#BD0026' :
          positif > 5000  ? '#E31A1C' :
          positif > 2500  ? '#FC4E2A' :
          positif > 1000   ? '#FD8D3C' :
          positif > 500   ? '#FEB24C' :
          positif > 250   ? '#FED976' :
                     '#FFEDA0';
  }

  var legend = L.control({position: 'topright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [0, 250, 500, 1000, 2000, 5000, 10000, 15000],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }

    return div;
};

legend.addTo(map);

  function style(f) {
  	var kode=f.properties.kode;
  	data = dataCovid[kode];
  	return {
  		weight: 1,
  		opacity: 1,
  		color: 'white',
  		dashArray: '3',
  		fillOpacity: 0.7,
  		fillColor: getColor(data.Kasus_Posi)
  	 };
   }

  // update jika hover
  function highlightFeature(e) {
  	var layer = e.target;

  	layer.setStyle({
  		weight: 1,
  		color: '#f00',
  		dashArray: '',
  		fillOpacity: 0.7
  	});

  	if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
  		layer.bringToFront();
  	}

  }
  // update info
  	function resetHighlight(e) {
  		var layer = e.target;
  		layer.setStyle({
  			weight: 1,
  			opacity: 1,
  			color: 'white',
  			dashArray: '3',
  			fillOpacity: 0.7,
  		})
  	}

    function onEachFeature(f, layer) {
  		layer.on({
  			mouseover: highlightFeature,
  			mouseout: resetHighlight
  		});
      var kode = f.properties.kode;
      data = dataCovid[kode];

      var popUp='<table>'+
  					'<tr>'+
  						'<td colspan="4"><h6>'+data.Provinsi+'</h6></td>'+
  					'</tr>'+
  					'<tr>'+
  						'<td><span class="left badge badge-warning p-2"><i class="fas fa-virus"></i></span></td>'+
  						'<td>Positif</td>'+
  						'<td class="text-right">'+data.Kasus_Posi+'</td>'+
  					'</tr>'+
  					'<tr>'+
  						'<td><span class="left badge badge-success p-2"><i class="fas fa-heart"></i></span></td>'+
  						'<td>Sembuh</td>'+
  						'<td class="text-right">'+data.Kasus_Semb+'</td>'+
  					'</tr>'+
  					'<tr>'+
  						'<td><span class="left badge badge-danger p-2"><i class="fas fa-heart-broken"></i></span></td>'+
  						'<td>Meninggal</td>'+
  						'<td class="text-right">'+data.Kasus_Meni+'</td>'+
  					'</tr>'+
  					'</table>';
      layer.bindPopup(popUp);
      geojson2[kode] = layer;
    }

    function getData() {
      $.ajax({
        url: api,
        dataType: "JSON",
        success: function(data) {
          var features = data.features;
          for (var i = 0; i < features.length; i++) {
            var attributes = features[i].attributes;
            var kodeProv = attributes.Kode_Provi;
            if (kodeProv != 0) {
              dataCovid[kodeProv] = attributes;

              var list = '<li data-id="'+kodeProv+'" class="nav-item"> <a href="#" class="nav-link"> <p> '+attributes.Provinsi+' </p> <br> <div class="row pl-3 pt-1"> <span class="badge badge-warning p-2 mt-1 mr-1"><i class="fas fa-virus mr-1"></i> '+attributes.Kasus_Posi+' </span> <span class="badge badge-success p-2 mt-1 mr-1"><i class="fas fa-heart mr-1"></i> '+attributes.Kasus_Semb+' </span>  <span class="badge badge-danger p-2 mt-1 mr-1"><i class="fas fa-heart-broken mr-1"></i> '+attributes.Kasus_Meni+' </span> </div> </a> </li>';

              $('#listProv').append(list);
            }
          }

          $.getJSON('geojson/indonesia.geojson', function(data){
            var features = data.features;
            for (var i = 0; i < features.length; i++) {
              var kode = features[i].properties.kode;
              var data2 = features[i];
              geojson[kode] = L.geoJSON(data2);
            }
            L.geoJSON(data,{
              onEachFeature:onEachFeature,
              style: style,
            }).addTo(map);
          })
          for (var i = 0; i < features.length; i++) {
            var attributes = features[i].attributes;
            var kodeProv = attributes.Kode_Provi;
          }
        }
      })
    }
</script>
</body>
</html>
